<!DOCTYPE html>
<html lang="ja">

<head>
    <title>1BG MetaSamurai 2 Check</title>
    <meta charset="utf-8">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.0/jquery.min.js"></script>
    <script type="text/javascript">
        $(function () {
            $("#response").html("Response Values");

            $("#button").click(function () {
                var url_katana = "https://api.etherscan.io/api?module=account&contractaddress=0x726EC2B0AF514706f2E3Be115798700450267c1C&apikey=T86KCJ94KGUE33ZSC49HT4CIKM5MV7IDM4&action=token1155tx&startblock=0&endblock=99999999&sort=desc&address=" + $("#address").val();
                var url_item = "https://api.etherscan.io/api?module=account&contractaddress=0xD1B78d9C30671A8CF3a1fCC64DE59D17F54A82C9&apikey=T86KCJ94KGUE33ZSC49HT4CIKM5MV7IDM4&action=token1155tx&startblock=0&endblock=99999999&sort=desc&address=" + $("#address").val();
                var list_katana_vol = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
                var list_item_vol = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]

                var list_katana_name = [
                    "",
                    "AirSmokeZero-ORG",
                    "Don't Cry",
                    "Devil Beenie",
                    "Blood Moon",
                    "Crown of Thorns",
                    "Restro Square 70",
                    "MS Beenie",
                    "Oval",
                    "Balaclava",
                    "Future Cat",
                    "Dinosaur",
                    "Supernova",
                    "Makaveli",
                    "Sunray",
                    "Medusa",
                    "MS Paisley Gantai",
                    "Head Band",
                    "Oversized Square",
                    "Fusion Mask",
                    "Uncommon"
                ]

                var list_item_name = [
                    "",
                    "AirSmokeZero-ORG",
                    "Don't Cry",
                    "Devil Beenie",
                    "Blood Moon",
                    "Crown of Thorns",
                    "Restro Square 70",
                    "MS Beenie",
                    "Oval",
                    "Balaclava",
                    "Future Cat",
                    "Dinosaur",
                    "Supernova",
                    "Makaveli",
                    "Sunray",
                    "Medusa",
                    "MS Paisley Gantai",
                    "Head Band",
                    "Oversized Square",
                    "Fusion Mask",
                    "Fuma",
                    "Blaze",
                    "Dynasty",
                    "Mars",
                    "Flying Gantai",
                    "momonari",
                    "Black ink",
                    "Oni",
                    "Spike",
                    "Zombie Beast"
                ]

                $.ajax({
                    type: 'get',
                    url: url_katana,
                    scriptCharset: 'utf-8',
                    success: function (data) {

                        json = data.result;

                        for (var i = 0; i < json.length; i++) {
                            if (json[i]["to"] == $("#address").val().toLowerCase()) {
                                mpyr = 1
                            }
                            else {
                                mpyr = -1
                            }
                            list_katana_vol[Number(json[i]["tokenID"]) - 1] = list_katana_vol[Number(json[i]["tokenID"]) - 1] + json[i]["tokenValue"] * mpyr
                        }

                    },

                    error: function (data) {
                        // Error
                        alert("error");
                        alert(JSON.stringify(data));
                        $("#response").html(JSON.stringify(data));
                    }
                });
                $.ajax({
                    type: 'get',
                    url: url_item,
                    scriptCharset: 'utf-8',
                    success: function (data) {

                        json = data.result;

                        for (var i = 0; i < json.length; i++) {
                            if (json[i]["to"] == $("#address").val().toLowerCase()) {
                                mpyr = 1
                            }
                            else {
                                mpyr = -1
                            }
                            list_item_vol[Number(json[i]["tokenID"]) - 1] = list_item_vol[Number(json[i]["tokenID"]) - 1] + json[i]["tokenValue"] * mpyr
                        }
                        // table要素を生成
                        var table = document.createElement('table');
                        var tr = document.createElement('tr');
                        var th = document.createElement('th');
                        th.textContent = "ID";
                        tr.appendChild(th);
                        var th = document.createElement('th');
                        th.textContent = "Item Name";
                        tr.appendChild(th);
                        var th = document.createElement('th');
                        th.textContent = "Quantity(Item)";
                        tr.appendChild(th);
                        var th = document.createElement('th');
                        th.textContent = "ID";
                        tr.appendChild(th);
                        var th = document.createElement('th');
                        th.textContent = "Katana Name";
                        tr.appendChild(th);
                        var th = document.createElement('th');
                        th.textContent = "Quantity(Katana)";
                        tr.appendChild(th);
                        table.appendChild(tr);

                        for (var i = 1; i <= list_item_name.length; i++) {
                            var tr = document.createElement('tr');
                            var td = document.createElement('td');
                            td.textContent = String(i + 1);
                            tr.appendChild(td);
                            var td = document.createElement('td');
                            td.textContent = list_item_name[i];
                            tr.appendChild(td);
                            var td = document.createElement('td');
                            td.textContent = list_item_vol[i];
                            tr.appendChild(td);
                            var td = document.createElement('td');
                            td.textContent = String(i + 1);
                            tr.appendChild(td);
                            var td = document.createElement('td');
                            td.textContent = list_katana_name[i];
                            tr.appendChild(td);
                            var td = document.createElement('td');
                            td.textContent = list_katana_vol[i];
                            tr.appendChild(td);
                            table.appendChild(tr);
                        }
                        document.getElementById('maintable').appendChild(table);
                        //
                        // table要素を生成
                        var table = document.createElement('table');
                        var tr = document.createElement('tr');
                        var th = document.createElement('th');
                        th.textContent = "ID";
                        tr.appendChild(th);
                        var th = document.createElement('th');
                        th.textContent = "Name";
                        tr.appendChild(th);
                        var th = document.createElement('th');
                        th.textContent = "Item";
                        tr.appendChild(th);
                        var th = document.createElement('th');
                        th.textContent = "Katana";
                        tr.appendChild(th);
                        table.appendChild(tr);

                        for (var i = 1; i <= list_katana_name.length - 2; i++) {
                            if (list_katana_vol[i] != list_item_vol[i]) {
                                var tr = document.createElement('tr');
                                var td = document.createElement('td');
                                td.textContent = String(i + 1);
                                tr.appendChild(td);
                                var td = document.createElement('td');
                                td.textContent = list_item_name[i];
                                tr.appendChild(td);
                                var td = document.createElement('td');
                                if (list_katana_vol[i] > list_item_vol[i]) {
                                    td.textContent = "";
                                }
                                else {
                                    td.textContent = String(list_item_vol[i] - list_katana_vol[i]);
                                }
                                tr.appendChild(td);
                                var td = document.createElement('td');
                                if (list_katana_vol[i] < list_item_vol[i]) {
                                    td.textContent = "";
                                }
                                else {
                                    td.textContent = String(list_katana_vol[i] - list_item_vol[i]);
                                }
                                tr.appendChild(td);
                                table.appendChild(tr);
                            }
                        }
                            if (list_katana_vol[i] != list_item_vol[i]) {
                                var tr = document.createElement('tr');
                                var td = document.createElement('td');
                                td.textContent = String(i + 1);
                                tr.appendChild(td);
                                var td = document.createElement('td');
                                td.textContent = list_item_name[i];
                                tr.appendChild(td);
                                var td = document.createElement('td');
                                if (list_katana_vol[i] > list_item_vol[i]) {
                                    td.textContent = "";
                                }
                                else {
                                    td.textContent = String(list_item_vol[i] - list_katana_vol[i]);
                                }
                                tr.appendChild(td);
                                var td = document.createElement('td');
                                if (list_katana_vol[i] < list_item_vol[i]) {
                                    td.textContent = "";
                                }
                                else {
                                    td.textContent = String(list_katana_vol[i] - list_item_vol[i]);
                                }
                                tr.appendChild(td);
                                table.appendChild(tr);
                            }
                        var red_item_num = list_item_vol[list_katana_name.length-1]+list_item_vol[list_katana_name.length]+list_item_vol[list_katana_name.length+1]+list_item_vol[list_katana_name.length+2]+list_item_vol[list_katana_name.length+3]+list_item_vol[list_katana_name.length+4]+list_item_vol[list_katana_name.length+5]+list_item_vol[list_katana_name.length+6]+list_item_vol[list_katana_name.length+7]+list_item_vol[list_katana_name.length+8]
                        if (list_katana_vol[list_katana_name.length-1] != red_item_num) {
                                var tr = document.createElement('tr');
                                var td = document.createElement('td');
                                td.textContent = "20~30";
                                tr.appendChild(td);
                                var td = document.createElement('td');
                                td.textContent = list_katana_name[list_katana_name.length-1];
                                tr.appendChild(td);
                                var td = document.createElement('td');
                                if (list_katana_vol[list_katana_name.length-1] < red_item_num) {
                                    td.textContent = String(red_item_num - list_katana_vol[list_katana_name.length-1]);
                                }
                                else {
                                    td.textContent = "";
                                }
                                tr.appendChild(td);
                                var td = document.createElement('td');
                                if (list_katana_vol[list_katana_name.length-1] > red_item_num) {
                                    td.textContent = String(list_katana_vol[list_katana_name.length-1] - red_item_num);
                                }
                                else {
                                    td.textContent = "";
                                }
                                tr.appendChild(td);
                                table.appendChild(tr);
                            }

                        document.getElementById('totaltable').appendChild(table);
                    },

                    error: function (data) {
                        // Error
                        alert("error");
                        alert(JSON.stringify(data));
                        $("#response").html(JSON.stringify(data));
                    }
                });
            })
        })
    </script>
    <style>
        body {
            background-color: rgb(0, 0, 0);
            color: rgb(106, 212, 0);
        }

        th {
            /* ヘッダ背景塗りつぶし */
            background: rgb(132, 132, 132);
            color: rgb(106, 212, 0);
            border: solid 1px;
            width: auto;
        }

        button {
            background: rgb(91, 91, 91);
            color: rgb(106, 212, 0);
        }

        td {
            /* 枠線を1本線指定 */
            border: solid 1px;
            width: auto;
            background: rgb(0, 0, 0);
            color: rgb(106, 212, 0);
            text-align: center;
        }

        table {
            /* 枠線を1本線指定 */
            border: solid 1px;
            border-collapse: collapse;
            white-space: nowrap;
        }

        footer {
            position: fixed;
            width: 100%;
            background-color: #C0C0C0;
            padding: 15px 0;
            bottom;
            /*下に固定*/
        }
    </style>

</head>

<body>
    <form action="#" method="post">
        <p>Wallet Address：<br>
            <input type="text" name="address" id="address">
        </p>
        <p><input type="button" value="Check MetaSamurai 2 Item & Katana" id="button"></p>
    </form>
    <p>属性が合わず、余っている保有トークン：<br>
    <div id='totaltable'></div>
    <hr>
    <p>ウォレット内のトークン一覧：<br>
    <div id='maintable'></div>

    <script>// ページング機能
        window.onload = function onLoad() {

            var params = new URLSearchParams(window.location.search);

            var target = document.getElementById("address");
            if (params.has("address") == true) {
                $("#address").val(params.get("address"));
                document.getElementById("button").click();
            }
        }
    </script>
</body>

</html>
