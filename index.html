<!DOCTYPE html>
<html lang="ja">

<head>
    <title>1BG MetaSamurai 2 Check</title>
    <meta charset="utf-8">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.0/jquery.min.js"></script>
    <script type="text/javascript">
        $(function () {
            $("#response").html("Response Values");

            $("#button").click(function () {
                var url_katana = "https://api.etherscan.io/api?module=account&contractaddress=0x726EC2B0AF514706f2E3Be115798700450267c1C&apikey=T86KCJ94KGUE33ZSC49HT4CIKM5MV7IDM4&action=token1155tx&startblock=0&endblock=99999999&sort=desc&address=" + $("#address").val();
                var url_item = "https://api.etherscan.io/api?module=account&contractaddress=0xD1B78d9C30671A8CF3a1fCC64DE59D17F54A82C9&apikey=T86KCJ94KGUE33ZSC49HT4CIKM5MV7IDM4&action=token1155tx&startblock=0&endblock=99999999&sort=desc&address=" + $("#address").val();
                var list_katana_vol = []
                var list_item_vol = []

                var list_katana_name = [
                    "",
                    "AirSmokeZero-ORG",
                    "Don't Cry",
                    "Devil Beenie",
                    "Blood Moon",
                    "Crown of Thorns",
                    "Restro Square 70",
                    "MS Beenie",
                    "Oval",
                    "Balaclava",
                    "Future Cat",
                    "Dinosaur",
                    "Supernova",
                    "Makaveli",
                    "Sunray",
                    "Medusa",
                    "MS Paisley Gantai",
                    "Head Band",
                    "Oversized Square",
                    "Fusion Mask",
                    "Uncommon"
                ]

                var list_item_name = [
                    "",
                    "AirSmokeZero-ORG",
                    "Don't Cry",
                    "Devil Beenie",
                    "Blood Moon",
                    "Crown of Thorns",
                    "Restro Square 70",
                    "MS Beenie",
                    "Oval",
                    "Balaclava",
                    "Future Cat",
                    "Dinosaur",
                    "Supernova",
                    "Makaveli",
                    "Sunray",
                    "Medusa",
                    "MS Paisley Gantai",
                    "Head Band",
                    "Oversized Square",
                    "Fusion Mask",
                    "Fuma",
                    "Blaze",
                    "Dynasty",
                    "Mars",
                    "Flying Gantai",
                    "momonari",
                    "Black ink",
                    "Oni",
                    "Spike",
                    "Zombie Beast"
                ]

                $.ajax({
                    type: 'get',
                    url: url_katana,
                    scriptCharset: 'utf-8',
                    success: function (data) {

                        json = data.result;

                        for (var i = 0; i < json.length; i++) {
                            if (json[i]["to"]==$("#address").val())
                            {
                                mpyr = 1
                            }
                            else
                            {
                                mpyr = -1                                
                            }
                            list_katana[Number(json[i]["tokenID"])] = list_katana[Number(json[i]["tokenID"])] + json[i]["tokenValue"] * mpyr
                        }          

                        // table要素を生成
                        var table = document.createElement('table');
                        var tr = document.createElement('tr');
                        var th = document.createElement('th');
                        th.textContent = "ID";
                        tr.appendChild(th);
                        var th = document.createElement('th');
                        th.textContent = "Item Name";
                        tr.appendChild(th);
                        var th = document.createElement('th');
                        th.textContent = "Quantity(Item)";
                        tr.appendChild(th);
                        var th = document.createElement('th');
                        th.textContent = "ID";
                        tr.appendChild(th);
                        var th = document.createElement('th');
                        th.textContent = "Katana Name";
                        tr.appendChild(th);
                        var th = document.createElement('th');
                        th.textContent = "Quantity(Katana)";
                        tr.appendChild(th);
                        table.appendChild(tr);

                        for (var i = 1; i <= list_item_name.length; i++) {
                            var tr = document.createElement('tr');
                            var th = document.createElement('th');
                            th.textContent = String(i);
                            tr.appendChild(th);
                            var th = document.createElement('th');
                            th.textContent = list_item_name[i];
                            tr.appendChild(th);
                            var th = document.createElement('th');
                            th.textContent = list_item_vol[i];
                            tr.appendChild(th);
                            var th = document.createElement('th');
                            th.textContent = String(i);
                            tr.appendChild(th);
                            var th = document.createElement('th');
                            th.textContent = list_item_name[i];
                            tr.appendChild(th);
                            var th = document.createElement('th');
                            th.textContent = list_item_vol[i];
                            tr.appendChild(th);
                            table.appendChild(tr);
                        }

                        error: function (data) {
                            // Error
                            alert("error");
                            alert(JSON.stringify(data));
                            $("#response").html(JSON.stringify(data));
                        }
                    });
            })
        })
    </script>
    <style>
        body {
            background-color: rgb(0, 0, 0);
            color: rgb(106, 212, 0);
        }

        div#paging {
            text-align: center;
            /* スクロールに対してページングボックスの位置を固定 */
            position: fixed;
            /* 位置を指定 */
            bottom;
            right: 45%;
        }

        div#pagingbox {
            background: rgb(0, 0, 0);
        }

        th {
            /* ヘッダ背景塗りつぶし */
            background: rgb(132, 132, 132);
            color: rgb(106, 212, 0);
            border: solid 1px;
            width: auto;
        }

        button {
            background: rgb(91, 91, 91);
            color: rgb(106, 212, 0);
        }

        td {
            /* 枠線を1本線指定 */
            border: solid 1px;
            width: auto;
            background: rgb(0, 0, 0);
            color: rgb(106, 212, 0);
            text-align: center;
        }

        table {
            /* 枠線を1本線指定 */
            border: solid 1px;
            border-collapse: collapse;
            white-space: nowrap;
        }

        footer {
            position: fixed;
            width: 100%;
            background-color: #C0C0C0;
            padding: 15px 0;
            bottom;
            /*下に固定*/
        }
    </style>

</head>

<body>
    <form action="#" method="post">
        <p>Wallet Address：<br>
            <input type="text" name="address" id="address">
        </p>
        <p><input type="button" value="Check DEFY Loot Items Log" id="button"></p>
    </form>
    <p>Total DEFY Loot Item you got (item burning is not considered. ):</p>
    <div id='totaltable'></div>
    <hr>
    <p>DEFY Loot Item Log:</p>
    <div id='maintable'></div>

    <!--ページングボタン配置-->
    <footer>
        <div id="paging">
            <table>
                <tr>
                    <tb><button id="prevbtn" type="button">
                            << /button>
                    </tb>
                    <tb>
                        <span id="currentpage">currentpage</span>
                        /
                        <span id="lastpage">lastpage</span>
                    </tb>
                    <tb><button id="nextbtn" type="button">></button></tb>
                </tr>
            </table>
        </div>
    </footer>

    <script>// ページング機能
        jQuery(function ($) {
            var page = 0;
            var displayrows = 30;// １ページ当たり表示する行の数

            function draw() {// ページの表示
                $('#lastpage').html(Math.ceil(($('tr').size() - 1) / displayrows));
                $('#currentpage').html(page + 1);
                $('tr').hide();
                $('tr:first,tr:gt(' + page * displayrows + '):lt(' + displayrows + ')').show();// 変数を使用する場合は' +  + 'を忘れずに
            }
            $('#prevbtn').click(function () {// １ページ後進
                if (page > 0) {
                    page--;
                    draw();
                }
            });
            $('#nextbtn').click(function () {// １ページ前進
                if (page < ($('tr').size() - 1) / displayrows - 1) {
                    page++;
                    draw();
                }
            });
            draw();//初回表示
        });
        window.onload = function onLoad() {

            var params = new URLSearchParams(window.location.search);

            var target = document.getElementById("address");
            if (params.has("address") == true) {
                $("#address").val(params.get("address"));
                document.getElementById("button").click();
            }
        }
    </script>
</body>

</html>
